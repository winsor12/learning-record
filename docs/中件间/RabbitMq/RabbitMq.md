# RabbitMq

消息队列（Message Queue）是一种在应用程序之间传递消息的技术，它允许一个应用程序向另一个应用程序异步发送消息，并使得应用程序在需要的时候进行处理。消息队列通常由三个组件组成：`生产者`、`消息队列`和`消费者`。

生产者（Producer）是指向消息队列中发送消息的应用程序或系统。它们通常负责将消息发布到消息队列，并且可以在消息发送后立即返回，而无需等待消息被消费者处理完毕。

消息队列（Message Queue）是指存储消息的缓冲区，它将生产者发送的消息保存在其中，直到被消费者取走为止。消息队列通常采用FIFO（First-In-First-Out）的方式管理消息，即先进先出的原则，保证了消息的顺序性和可靠性。

消费者（Consumer）是指从消息队列中接收消息并进行处理的应用程序或系统。它们通常会长时间运行，并等待消息队列中有新的消息出现。一旦有新的消息到达，消费者会从消息队列中取走消息并进行处理。

## Work Queues

工作队列（任务队列），是一种消息队列模式的实现方式，用于在分布式系统中处理耗时的任务和大量的工作。生产者发布任务到消息队列，多个消费者之间进行分配。

每个消息只能有一个消费者处理。

工作队列的主要优点是可以通过水平扩展消费者的数量来实现更高的并发处理能力，同时也能实现任务的`负载均衡`和`故障恢复`。

### 循环调度

默认情况下，RabbitMq会按顺序平均将消息分配给消费者。例如，有消费者c1、c2、c3,同时有消息q1、q2、q3，RabbitMq会将q1分配给c1，q2分配给c2，q3分配给c3。

### 消息确认

一个消费者A如果死亡，那么它处理的消息也会丢失。消息队列如果没有等到消费者A返回的ack，会认为消息没有被处理，会进行重新排队。若此时有其它消费者B在线，则会将消息重新发送给消费者B。如果消息队列收到消费者传来的确认消息，表明消息已接收，则可以自由删除消息。

### 消息耐久性

若RabbitMq服务器停止，则消息还是会丢失。

```
channel.queueDeclare("hello", true, false, false, null);
```

其中第二个参数可以设置持久性。

### 公平分配

防止出现一个消费者一直处理重消息，另一个消费者只处理轻消息。

```
channel.basicQos(1);
```

设置消费者最多处理多少条消息。

![image-20230402010643229](D:\Projects\gitCode\learning-record\docs\image\image-20230402010643229.png)